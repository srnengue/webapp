<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ã«ã’ã¾ã£ã—</title>
    <style>
        /* ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: #f5f7fa; min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
            padding: 20px 30px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .header-content {
            max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-logo { font-size: 36px; }
        .header-title { font-size: 24px; font-weight: 700; }
        .header-user { display: flex; align-items: center; gap: 20px; }
        .user-info { font-size: 14px; opacity: 0.9; }
        .logout-btn {
            background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 10px 24px;
            border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s;
        }
        .logout-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px; }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            display: flex; align-items: center; gap: 20px; transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12); }
        .stat-icon {
            font-size: 48px; width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border-radius: 15px;
        }
        .stat-icon.red { background: linear-gradient(135deg, #FF6B6B 0%, #FFB347 100%); }
        .stat-icon.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-icon.orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-icon.purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-info { flex: 1; }
        .stat-number { font-size: 32px; font-weight: 800; color: #333; }
        .stat-label { font-size: 14px; color: #666; margin-top: 5px; }

        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 25px; background: white;
            padding: 10px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        .nav-tab {
            flex: 1; padding: 15px 25px; background: transparent; border: none;
            border-radius: 12px; font-size: 16px; font-weight: 700; color: #666;
            cursor: pointer; transition: all 0.3s;
        }
        .nav-tab:hover { background: #f8f9fa; }
        .nav-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        
        .content-section { display: none; }
        .content-section.active { display: block; }

        .actions-bar {
            background: white; padding: 20px 25px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;
        }
        .actions-title { font-size: 20px; font-weight: 700; color: #333; }
        .create-btn {
            background: linear-gradient(135deg, #FF6B6B 0%, #FFB347 100%); color: white; border: none;
            padding: 14px 28px; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer;
            transition: all 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .create-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4); }
        
        .surveys-container {
            background: white; padding: 30px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }
        .table-header {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 200px; gap: 15px; padding: 15px 20px;
            background: #f8f9fa; border-radius: 12px; font-weight: 700; color: #666; font-size: 14px; margin-bottom: 15px;
        }
        .survey-item {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 200px; gap: 15px; padding: 22px;
            border: 3px solid #f0f0f0; border-radius: 15px; margin-bottom: 12px; align-items: center; transition: all 0.3s;
        }
        .survey-item:hover { border-color: #FF6B6B; background: #FFF9F0; transform: translateX(5px); }
        .survey-title-col { font-weight: 700; color: #333; font-size: 16px; }
        .survey-desc { font-size: 13px; color: #999; margin-top: 5px; }
        
        .survey-status { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .status-active { background: #d4edda; color: #155724; }
        
        .survey-col { color: #666; font-size: 14px; font-weight: 600; }
        .action-buttons { display: flex; gap: 8px; }
        .action-btn {
            padding: 10px 14px; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 700; transition: all 0.3s;
        }
        .btn-view { background: #667eea; color: white; }
        .btn-analysis { background: #28a745; color: white; }
        .btn-edit { background: #FFB347; color: white; }
        .btn-delete { background: #FF6B6B; color: white; }
        
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-title { font-size: 20px; color: #333; margin-bottom: 10px; font-weight: 700; }
        
        @media (max-width: 1200px) {
            .table-header, .survey-item { grid-template-columns: 2fr 1fr 1fr 200px; }
            .table-header .hide-mobile, .survey-item .hide-mobile { display: none; }
        }
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; align-items: flex-start; }
            .table-header { display: none; }
            .survey-item { grid-template-columns: 1fr; gap: 10px; }
            .action-buttons { justify-content: flex-start; }
            .nav-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-logo">ğŸƒâ€â™‚ï¸</div>
                <div class="header-title">ã«ã’ã¾ã£ã— ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
            </div>
            <div class="header-user">
                <div class="user-info">ğŸ‘¤ <span id="adminName">admin</span></div>
                <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon red">ğŸ“Š</div>
                <div class="stat-info">
                    <div class="stat-number" id="totalSurveys">-</div>
                    <div class="stat-label">ç·ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ•°</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">âœ…</div>
                <div class="stat-info">
                    <div class="stat-number" id="activeSurveys">-</div>
                    <div class="stat-label">å…¬é–‹ä¸­</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">ğŸ“</div>
                <div class="stat-info">
                    <div class="stat-number" id="totalResponses">-</div>
                    <div class="stat-label">ç·å›ç­”æ•°</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">ğŸ¯</div>
                <div class="stat-info">
                    <div class="stat-number" id="totalQuizzes">4</div>
                    <div class="stat-label">ã‚¯ã‚¤ã‚ºæ•°</div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('surveys')">ğŸ“Š ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç®¡ç†</button>
            <button class="nav-tab" onclick="switchTab('quizzes')">ğŸ¯ ã‚¯ã‚¤ã‚ºç®¡ç†</button>
        </div>

        <div id="surveysSection" class="content-section active">
            <div class="actions-bar">
                <div class="actions-title">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä¸€è¦§</div>
                <button class="create-btn" onclick="createSurvey()">
                    <span>â•</span>
                    <span>æ–°è¦ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä½œæˆ</span>
                </button>
            </div>
            <div class="surveys-container">
                <div class="table-header">
                    <div>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå</div>
                    <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                    <div>å›ç­”æ•°</div>
                    <div class="hide-mobile">ä½œæˆæ—¥</div>
                    <div class="hide-mobile">è³ªå•æ•°</div>
                    <div>æ“ä½œ</div>
                </div>
                <div id="surveysList">
                    <div style="text-align:center; padding:20px;">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>
        </div>

        <div id="quizzesSection" class="content-section">
            <div class="actions-bar">
                <div class="actions-title">ã‚¯ã‚¤ã‚ºä¸€è¦§</div>
                <button class="create-btn" onclick="createQuiz()">
                    <span>â•</span>
                    <span>æ–°è¦ã‚¯ã‚¤ã‚ºä½œæˆ</span>
                </button>
            </div>
            <div class="surveys-container">
                <div class="table-header">
                    <div>ã‚¯ã‚¤ã‚ºå</div>
                    <div>ã‚«ãƒ†ã‚´ãƒªãƒ¼</div>
                    <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                    <div class="hide-mobile">è³ªå•æ•°</div>
                    <div class="hide-mobile">ä½œæˆæ—¥</div>
                    <div>æ“ä½œ</div>
                </div>
                <div id="quizzesList"></div>
            </div>
        </div>
    </div>

    <script>
    // â˜…ã“ã“ã«GASã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„
    const GAS_ENDPOINT_GET = 'https://script.google.com/macros/s/AKfycbwl8icMgU0epsqXX-uqE4KRA558xH0YECdpPp18rAhnaLqvqyDzoYJr2_cmQs7KHuoWgw/exec';

    let allResponses = [];
    let allSurveys = [];
    
    // ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ï¼ˆå›ºå®šï¼‰
    const quizzes = [
        { id: 1, title: 'é˜²ç½ã®åŸºæœ¬ã‚¯ã‚¤ã‚º', category: 'é˜²ç½åŸºç¤çŸ¥è­˜', status: 'active', questions: 3, createdDate: '2024-12-01' },
        { id: 2, title: 'é¿é›£æ‰€ã«é–¢ã™ã‚‹ã‚¯ã‚¤ã‚º', category: 'é¿é›£æ‰€çŸ¥è­˜', status: 'active', questions: 3, createdDate: '2024-12-01' },
        { id: 3, title: 'ç½å®³æƒ…å ±ã®å–å¾—æ–¹æ³•', category: 'ç½å®³æƒ…å ±', status: 'active', questions: 3, createdDate: '2024-12-01' },
        { id: 4, title: 'ã‚¢ãƒ—ãƒªæ©Ÿèƒ½ã‚¯ã‚¤ã‚º', category: 'ã«ã’ã¾ã£ã—ã‚¢ãƒ—ãƒª', status: 'active', questions: 5, createdDate: '2024-12-01' }
    ];

    function switchTab(tab) {
        document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

        if (tab === 'surveys') {
            document.querySelector('.nav-tab:nth-child(1)').classList.add('active');
            document.getElementById('surveysSection').classList.add('active');
        } else if (tab === 'quizzes') {
            document.querySelector('.nav-tab:nth-child(2)').classList.add('active');
            document.getElementById('quizzesSection').classList.add('active');
        }
    }

    async function loadDataAndRender() {
        const container = document.getElementById('surveysList');
        try {
            const response = await fetch(GAS_ENDPOINT_GET);
            const data = await response.json();
            
            if (data.result === "success") {
                allResponses = data.responses || [];
                allSurveys = data.surveys || [];
                updateStats();
                renderSurveys();
                renderQuizzes();
            } else {
                container.innerHTML = `<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
            }
        } catch (error) {
            console.error('Error:', error);
            container.innerHTML = `<div class="empty-state">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>`;
        }
    }

    function updateStats() {
        const countMap = {};
        allResponses.forEach(res => {
            const sId = String(res.surveyId);
            countMap[sId] = (countMap[sId] || 0) + 1;
        });
        
        document.getElementById('totalSurveys').textContent = allSurveys.length;
        document.getElementById('activeSurveys').textContent = allSurveys.filter(s => s.status === 'active').length;
        document.getElementById('totalResponses').textContent = allResponses.length;
        document.getElementById('totalQuizzes').textContent = quizzes.length;

        allSurveys.forEach(s => {
            s.responses = countMap[String(s.id)] || 0;
        });
    }

    function renderSurveys() {
        const container = document.getElementById('surveysList');
        
        if (allSurveys.length === 0) {
            container.innerHTML = `<div class="empty-state"><div class="empty-title">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</div></div>`;
            return;
        }

        allSurveys.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

        container.innerHTML = allSurveys.map(survey => {
            const dateStr = new Date(survey.createdAt).toLocaleDateString();
            return `
                <div class="survey-item">
                    <div class="survey-title-col">
                        ${survey.title}
                        <div class="survey-desc">${survey.description || ''}</div>
                    </div>
                    <div class="survey-col"><span class="survey-status status-active">å…¬é–‹ä¸­</span></div>
                    <div class="survey-col">${survey.responses}ä»¶</div>
                    <div class="survey-col hide-mobile">${dateStr}</div>
                    <div class="survey-col hide-mobile">${survey.questions.length}å•</div>
                    <div class="action-buttons">
                        <button class="action-btn btn-view" onclick="viewResults('${survey.id}')" title="å›ç­”ä¸€è¦§">ğŸ“‹ çµæœ</button>
                        <button class="action-btn btn-analysis" onclick="viewAnalysis('${survey.id}')" title="åˆ†æãƒ¬ãƒãƒ¼ãƒˆ">ğŸ“ˆ åˆ†æ</button>
                        <button class="action-btn btn-delete" onclick="deleteSurvey('${survey.id}')" title="å‰Šé™¤">ğŸ—‘ï¸</button>
                    </div>
                </div>`;
        }).join('');
    }

    function renderQuizzes() {
        const container = document.getElementById('quizzesList');
        container.innerHTML = quizzes.map(quiz => `
            <div class="survey-item">
                <div class="survey-title-col">${quiz.title}</div>
                <div class="survey-col">${quiz.category}</div>
                <div class="survey-col"><span class="survey-status status-active">å…¬é–‹ä¸­</span></div>
                <div class="survey-col hide-mobile">${quiz.questions}å•</div>
                <div class="survey-col hide-mobile">${quiz.createdDate}</div>
                <div class="action-buttons">
                    <button class="action-btn btn-edit" onclick="alert('ã‚¯ã‚¤ã‚ºç·¨é›†ã¯å®Ÿè£…äºˆå®šã§ã™')" title="ç·¨é›†">âœï¸</button>
                    <button class="action-btn btn-delete" onclick="alert('ã‚¯ã‚¤ã‚ºå‰Šé™¤ã¯å®Ÿè£…äºˆå®šã§ã™')" title="å‰Šé™¤">ğŸ—‘ï¸</button>
                </div>
            </div>
        `).join('');
    }

    async function deleteSurvey(id) {
        if(!confirm('æœ¬å½“ã«ã“ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
        const payload = { action: 'deleteSurvey', id: id };
        try {
            await fetch(GAS_ENDPOINT_GET, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            alert('å‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚\nç”»é¢ã‚’æ›´æ–°ã—ã¾ã™ã€‚');
            setTimeout(loadDataAndRender, 1000);
        } catch(e) {
            alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
    }

    function viewResults(id) { window.location.href = `results.html?id=${id}`; }
    function viewAnalysis(id) { window.location.href = `analysis.html?id=${id}`; }
    function createSurvey() { window.location.href = 'create.html'; }
    function createQuiz() { alert('æ–°è¦ã‚¯ã‚¤ã‚ºä½œæˆã¯å®Ÿè£…äºˆå®šã§ã™'); }
    function logout() {
        localStorage.removeItem('adminLoggedIn');
        localStorage.removeItem('adminUsername');
        sessionStorage.removeItem('adminLoggedIn');
        sessionStorage.removeItem('adminUsername');
        window.location.href = 'index.html';
    }

    window.addEventListener('load', function() {
        const isLoggedIn = localStorage.getItem('adminLoggedIn') || sessionStorage.getItem('adminLoggedIn');
        if (isLoggedIn !== 'true') {
            window.location.href = 'login.html';
            return;
        }
        document.getElementById('adminName').textContent = localStorage.getItem('adminUsername') || 'admin';
        loadDataAndRender();
    });
</script>
</body>
</html>